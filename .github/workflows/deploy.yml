name: ğŸš€ Validar y Publicar en GitHub Pages

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

# Permisos necesarios para publicar en GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Evita despliegues simultÃ¡neos
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 1: VALIDACIONES
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  validar:
    name: âœ… Validar Proyecto
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Descargar cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ“ Verificar que existen los archivos requeridos
        run: |
          echo "ğŸ” Verificando archivos del proyecto..."

          if [ ! -f "index.html" ]; then
            echo "âŒ ERROR: No se encontrÃ³ index.html"
            exit 1
          else
            echo "âœ… index.html encontrado"
          fi

          if [ ! -f "estilo.css" ]; then
            echo "âŒ ERROR: No se encontrÃ³ estilo.css"
            exit 1
          else
            echo "âœ… estilo.css encontrado"
          fi

          if [ ! -f "script.js" ]; then
            echo "âŒ ERROR: No se encontrÃ³ script.js"
            exit 1
          else
            echo "âœ… script.js encontrado"
          fi

          if [ ! -f "README.md" ]; then
            echo "âš ï¸  ADVERTENCIA: No se encontrÃ³ README.md (recomendado)"
          else
            echo "âœ… README.md encontrado"
          fi

      - name: ğŸ”— Verificar que CSS estÃ¡ enlazado en HTML
        run: |
          echo "ğŸ” Verificando enlace de estilo.css en index.html..."
          if grep -q "estilo.css" index.html; then
            echo "âœ… estilo.css estÃ¡ correctamente enlazado"
          else
            echo "âŒ ERROR: estilo.css no estÃ¡ enlazado en index.html"
            exit 1
          fi

      - name: ğŸ”— Verificar que JS estÃ¡ enlazado en HTML
        run: |
          echo "ğŸ” Verificando enlace de script.js en index.html..."
          if grep -q "script.js" index.html; then
            echo "âœ… script.js estÃ¡ correctamente enlazado"
          else
            echo "âŒ ERROR: script.js no estÃ¡ enlazado en index.html"
            exit 1
          fi

      - name: ğŸ·ï¸ Verificar estructura HTML bÃ¡sica
        run: |
          echo "ğŸ” Verificando estructura bÃ¡sica del HTML..."
          if grep -q "<!DOCTYPE html>" index.html; then
            echo "âœ… DOCTYPE declarado correctamente"
          else
            echo "âš ï¸  ADVERTENCIA: DOCTYPE no encontrado"
          fi

          if grep -q "<title>" index.html; then
            echo "âœ… Etiqueta <title> encontrada"
          else
            echo "âš ï¸  ADVERTENCIA: No se encontrÃ³ etiqueta <title>"
          fi

          if grep -q "calcularAportes" script.js; then
            echo "âœ… FunciÃ³n calcularAportes() encontrada en script.js"
          else
            echo "âŒ ERROR: No se encontrÃ³ la funciÃ³n principal calcularAportes()"
            exit 1
          fi

      - name: ğŸ“Š Resumen de validaciones
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  âœ… TODAS LAS VALIDACIONES PASARON"
          echo "  ğŸš€ Listo para desplegar..."
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 2: DESPLIEGUE (solo en push a main)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  desplegar:
    name: ğŸŒ Publicar en GitHub Pages
    runs-on: ubuntu-latest
    needs: validar  # Solo se ejecuta si las validaciones pasan
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: ğŸ“¥ Descargar cÃ³digo
        uses: actions/checkout@v4

      - name: âš™ï¸ Configurar GitHub Pages
        uses: actions/configure-pages@v4

      - name: ğŸ“¦ Empaquetar archivos del sitio
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'   # Sube todo el contenido del repositorio

      - name: ğŸš€ Desplegar en GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: ğŸ‰ PublicaciÃ³n exitosa
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  ğŸ‰ SITIO PUBLICADO EXITOSAMENTE"
          echo "  ğŸ”— URL: ${{ steps.deployment.outputs.page_url }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
